
function ranswers (req) {
var answers = [
req.body.Q001 , 
req.body.Q002 , 
req.body.Q003 , 
req.body.Q004 , 
req.body.Q005 , 
req.body.Q006 , 
req.body.Q007 , 
req.body.Q008 , 
req.body.Q009 , 
req.body.Q010 , 
req.body.Q011 , 
req.body.Q012 , 
req.body.Q013 , 
req.body.Q014 , 
req.body.Q015 , 
req.body.Q016 , 
req.body.Q017 , 
req.body.Q018 , 
req.body.Q019 , 
req.body.Q020 , 
req.body.Q021 , 
req.body.Q022 , 
req.body.Q023 , 
req.body.Q024 , 
req.body.Q025 , 
req.body.Q026 , 
req.body.Q027 , 
req.body.Q028 , 
req.body.Q029 , 
req.body.Q030 , 
req.body.Q031 , 
req.body.Q032 , 
req.body.Q033 , 
req.body.Q034 , 
req.body.Q035 , 
req.body.Q036 , 
req.body.Q037 , 
req.body.Q038 , 
req.body.Q039 , 
req.body.Q040 , 
req.body.Q041 , 
req.body.Q042 , 
req.body.Q043 , 
req.body.Q044 , 
req.body.Q045 , 
req.body.Q046 , 
req.body.Q047 , 
req.body.Q048 , 
req.body.Q049 , 
req.body.Q050 , 
req.body.Q051 , 
req.body.Q052 , 
req.body.Q053 , 
req.body.Q054 , 
req.body.Q055 , 
req.body.Q056 , 
req.body.Q057 , 
req.body.Q058 , 
req.body.Q059 , 
req.body.Q060 , 
req.body.Q061 , 
req.body.Q062 , 
req.body.Q063 , 
req.body.Q064 , 
req.body.Q065 , 
req.body.Q066 , 
req.body.Q067 , 
req.body.Q068 , 
req.body.Q069 , 
req.body.Q070 , 
req.body.Q071 , 
req.body.Q072 , 
req.body.Q073 , 
req.body.Q074 , 
req.body.Q075 , 
req.body.Q076 , 
req.body.Q077 , 
req.body.Q078 , 
req.body.Q079 , 
req.body.Q080 , 
req.body.Q081 , 
req.body.Q082 , 
req.body.Q083 , 
req.body.Q084 , 
req.body.Q085 , 
req.body.Q086 , 
req.body.Q087 , 
req.body.Q088 , 
req.body.Q089 , 
req.body.Q090 , 
req.body.Q091 , 
req.body.Q092 , 
req.body.Q093 , 
req.body.Q094 , 
req.body.Q095 , 
req.body.Q096 , 
req.body.Q097 , 
req.body.Q098 , 
req.body.Q099 , 
req.body.Q100 , 
req.body.Q101 , 
req.body.Q102 , 
req.body.Q103 , 
req.body.Q104 , 
req.body.Q105 , 
req.body.Q106 , 
req.body.Q107 , 
req.body.Q108 , 
req.body.Q109 , 
req.body.Q110 , 
req.body.Q111 , 
req.body.Q112 , 
req.body.Q113 , 
req.body.Q114 , 
req.body.Q115 , 
req.body.Q116 , 
req.body.Q117 , 
req.body.Q118 , 
req.body.Q119 , 
req.body.Q120 , 
req.body.Q121 , 
req.body.Q122 , 
req.body.Q123 , 
req.body.Q124 , 
req.body.Q125 , 
req.body.Q126 , 
req.body.Q127 , 
req.body.Q128 , 
req.body.Q129 , 
req.body.Q130 , 
req.body.Q131 , 
req.body.Q132 , 
req.body.Q133 , 
req.body.Q134 , 
req.body.Q135 , 
req.body.Q136 , 
req.body.Q137 , 
req.body.Q138 , 
req.body.Q139 , 
req.body.Q140 , 
req.body.Q141 , 
req.body.Q142 , 
req.body.Q143 , 
req.body.Q144 , 
req.body.Q145 , 
req.body.Q146 , 
req.body.Q147 , 
req.body.Q148 , 
req.body.Q149 , 
req.body.Q150 , 
req.body.Q151 , 
req.body.Q152 , 
req.body.Q153 , 
req.body.Q154 , 
req.body.Q155 , 
req.body.Q156 , 
req.body.Q157 , 
req.body.Q158 , 
req.body.Q159 , 
req.body.Q160 , 
req.body.Q161 , 
req.body.Q162 , 
req.body.Q163 , 
req.body.Q164 , 
req.body.Q165 , 
req.body.Q166 , 
req.body.Q167 , 
req.body.Q168 , 
req.body.Q169 , 
req.body.Q170 , 
req.body.Q171 , 
req.body.Q172 , 
req.body.Q173 , 
req.body.Q174 , 
req.body.Q175 , 
req.body.Q176 , 
req.body.Q177 , 
req.body.Q178 , 
req.body.Q179 , 
req.body.Q180 , 
req.body.Q181 , 
req.body.Q182 , 
req.body.Q183 , 
req.body.Q184 , 
req.body.Q185 , 
req.body.Q186 , 
req.body.Q187 , 
req.body.Q188 , 
req.body.Q189 , 
req.body.Q190 , 
req.body.Q191 , 
req.body.Q192 , 
req.body.Q193 , 
req.body.Q194 , 
req.body.Q195 , 
req.body.Q196 , 
req.body.Q197 , 
req.body.Q198 , 
req.body.Q199 , 
req.body.Q200 , 
req.body.Q201 , 
req.body.Q202 , 
req.body.Q203 , 
req.body.Q204 , 
req.body.Q205 , 
req.body.Q206 , 
req.body.Q207 , 
req.body.Q208 , 
req.body.Q209 , 
req.body.Q210 , 
req.body.Q211 , 
req.body.Q212 , 
req.body.Q213 , 
req.body.Q214 , 
req.body.Q215 , 
req.body.Q216 , 
req.body.Q217 , 
req.body.Q218 , 
req.body.Q219 , 
req.body.Q220 , 
req.body.Q221 , 
req.body.Q222 , 
req.body.Q223 , 
req.body.Q224 , 
req.body.Q225 , 
req.body.Q226 , 
req.body.Q227 , 
req.body.Q228 , 
req.body.Q229 , 
req.body.Q230 , 
req.body.Q231 , 
req.body.Q232 , 
req.body.Q233 , 
req.body.Q234 , 
req.body.Q235 , 
req.body.Q236 , 
req.body.Q237 , 
req.body.Q238 , 
req.body.Q239 , 
req.body.Q240 , 
req.body.Q241 , 
req.body.Q242 , 
req.body.Q243 , 
req.body.Q244 , 
req.body.Q245 , 
req.body.Q246 , 
req.body.Q247 , 
req.body.Q248 , 
req.body.Q249 , 
req.body.Q250 , 
req.body.Q251 , 
req.body.Q252 , 
req.body.Q253 , 
req.body.Q254 , 
req.body.Q255 , 
req.body.Q256 , 
req.body.Q257 , 
req.body.Q258 , 
req.body.Q259 , 
req.body.Q260 , 
req.body.Q261 , 
req.body.Q262 , 
req.body.Q263 , 
req.body.Q264 , 
req.body.Q265 , 
req.body.Q266 , 
req.body.Q267 , 
req.body.Q268 , 
req.body.Q269 , 
req.body.Q270 , 
req.body.Q271 , 
req.body.Q272 , 
req.body.Q273 , 
req.body.Q274 , 
req.body.Q275 , 
req.body.Q276 , 
req.body.Q277 , 
req.body.Q278 
]
return answers;
};



// external modules
var http = require('http');		// http server (without express framework)
var express = require('express');	// express framework (page routing)
var hbs = require ('hbs');			// handlebars template system





// express.js engine
var app = express();
app.use(express.static('public'));       // public static content


var bodyParser = require('body-parser')
app.use( bodyParser.json() );       // to support JSON-encoded bodies
app.use(bodyParser.urlencoded({     // to support URL-encoded bodies
  extended: true
})); 
//app.use(express.urlencoded());
//app.use(express.json());      // if needed



// set the view engine to use handlebars
app.set ('view engine', 'hbs');
app.set('views', __dirname + '/views'); // rendered views


var moment = require('moment');

// start http server.
var server = app.listen(8000, function () {
  var host = server.address().address
  var port = server.address().port
  console.log('homeopathy app listening at http://%s:%s', host, port)
  console.log("time is: " + moment().format() );
})


var model = require('./model.js');
var db = require('./database.js');

// test it, with the demo data we put in (so that it brings an error at startup and not at runtime)
console.log("Testing with demo data..");
var demo = require('./model_demo_data.js');
var demo_remedy = model.find_remedies (demo.data,false); // log the first time..




var texte = require('./texte.js');

app.get('/', function(req, res) {
   res.redirect('/en');
});

var test = [
{ name: "Coccolu", number:"R001", correlation: 0.1234 },
{ name: "Ferrum", number:"R002", correlation: 0.55 }
]

// RENDER LIVE RESULT ********************************************************************

// multi language rendering
app.get('/result', function(req, res) {
     res.locals = {
        language: 'de',
        remedies:  demo_remedy // test, //
     };
     res.render('bestremedies');
});


function format_result ( res ) {

}

app.post('/sendquestions', function(req, res){    
    console.log("questions have been sent back...");

    if (req.body.username==null) {
      console.log("user is null..");
    }
    else {
       console.log("user is: " + req.body.username);
    }

    //console.log("req is: "+ JSON.stringify(req.body) );

    var answers = ranswers (req);
    //console.log("answers: " + answers);


    // write Questions to Database
    db.writeQuestionsToDB (req.body.username, answers, req.connection.remoteAddress );


    var remedies = model.find_remedies (answers,false);

     res.locals = {
        language: req.body.username,
        remedies: remedies,
        jsondata: JSON.stringify(remedies)
     };
     res.render('bestremedies');


    //var email = sReq.query.email.;   
    //res.json(req.body);
});


// PAST QUESTIONS ****************************************************************************

app.get('/admin/questionlist', function(req, res) {
   console.log("rendering past questionaire list");
   db.pastQuestionList (  function (e, questions) {
      res.locals = {
         language:  'en',
         questions:  questions,
      };
      res.render('pastquestionlist');
   });
});



app.get('/admin/question/:id', function(req, res) {
   var id = req.params.id;
   console.log("rendering past questionaire page: " + id);

   db.pastQuestion ( id, function (e, dbEntry) {
      console.log("Found old entry : " + dbEntry.ip + " " + dbEntry.name + " " + dbEntry.date );
      //console.log("found questions: " + dbEntry.questions);
      var remedies = model.find_remedies (dbEntry.questions,false);
           

      res.locals = {
         language: dbEntry.ip + " " + dbEntry.name + " " + dbEntry.date,
         remedies:  remedies,
         jsondata: JSON.stringify(remedies), 
      };
      res.render('bestremedies');
   });
});



// QUESTIONAIRE RENDERING **********************************************************************



// multi language rendering
app.get('/:language', function(req, res) {
   var language = req.params.language+ "";
   console.log("rendering in language: " + language);

   if (language == 'de') {
	res.locals = {
        language: 'de',
        questions: texte.questions.de,
	   app: texte.app.de,
	   sources: texte.sources,
	   faq: texte.faq.de,
     }
	res.render('questions');
   }
   else if (language == 'en') {
	res.locals = {
        language: 'en',
        questions: texte.questions.en,
	   app: texte.app.en,
	   sources: texte.sources,
	   faq: texte.faq.en,
     }
	res.render('questions');
   }
   else if (language == 'es') {
	res.locals = {
        language: 'es',
        questions: texte.questions.es,
	   app: texte.app.es,
	   sources: texte.sources,
	   faq: texte.faq.es,
     }
	res.render('questions');
   }
   else if (language == 'eo') {
	res.locals = {
        language: 'eo',
        questions: texte.questions.eo,
	   app: texte.app.eo,
	   sources: texte.sources,
	   faq: texte.faq.eo,
     }
	res.render('questions');
   }
   else if (language == 'fr') {
	res.locals = {
        language: 'fr',
        questions: texte.questions.fr,
	   app: texte.app.fr,
	   sources: texte.sources,
	   faq: texte.faq.fr,
     }
	res.render('questions');
   }
   else if (language == 'it') {
	res.locals = {
        language: 'it',
        questions: texte.questions.it,
	   app: texte.app.it,
	   sources: texte.sources,
	   faq: texte.faq.it,
     }
	res.render('questions');
   }

   else {
      res.send('Language not supported. Can you help us translate to your language?');
   }

});






